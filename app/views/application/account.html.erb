<h1>Account</h1>

<div class="section-divider flex-col gap-sm">
  <h2>Subscription</h2>

  <% if @subscription %>
    <dl>
      <dt><strong>Status:</strong></dt>
      <dd>
        <%= @subscription[:status].capitalize %>
        <% if @subscription[:cancel_at_period_end] %>
          <span class="error-text">(Canceling at period end)</span>
        <% end %>
      </dd>

      <dt><strong>Amount:</strong></dt>
      <dd>$<%= @subscription[:amount] / 100 %> / <%= @subscription[:interval] %></dd>

      <% if @subscription[:cancel_at_period_end] %>
        <dt><strong>Access ends:</strong></dt>
      <% else %>
        <dt><strong>Next billing date:</strong></dt>
      <% end %>
      <dd><%= @subscription[:current_period_end].strftime("%B %d, %Y") %></dd>

      <% if @subscription[:cancel_at_period_end] %>
        <dt><strong>Manage:</strong></dt>
        <dd>
          <%= button_to "Cancel immediately",
              subscription_path(immediately: true),
              method: :delete,
              class: "exit",
              data: { turbo_confirm: "End access now? This cannot be undone." } %>
          <div class="mt-sm muted">
            After canceling immediately, you'll be able to start a new subscription
          </div>
        </dd>
      <% else %>
        <dt><strong>Manage:</strong></dt>
        <dd>
          <%= button_to "Cancel Subscription",
              subscription_path,
              method: :delete,
              class: "exit" %>
        </dd>
      <% end %>
    </dl>
  <% else %>
    <dl>
      <dt><strong>Status:</strong></dt>
      <dd>
        Not subscribed
      </dd>

      <dt><strong>Manage:</strong></dt>
      <dd>
        <div class="flex-col gap-sm">
          <div>All tiers provide identical access – this number is you signaling to yourself what this means to you.</div>

          <div class="flex-row gap-md">
            <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
              <%= f.hidden_field :tier, value: "tier_1" %>
              <%= f.submit "$1/month", name: nil %>
            <% end %>

            <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
              <%= f.hidden_field :tier, value: "tier_10" %>
              <%= f.submit "$10/month", name: nil %>
            <% end %>

            <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
              <%= f.hidden_field :tier, value: "tier_100" %>
              <%= f.submit "$100/month", name: nil %>
            <% end %>

            <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
              <%= f.hidden_field :tier, value: "tier_1000" %>
              <%= f.submit "$1000/month", name: nil %>
            <% end %>
          </div>

          <div class="muted">Learn more about Pay What Feels Good: <a href="https://lightward.inc/pricing" target="_blank">lightward.inc/pricing</a></div>
        </div>
      </dd>
    </dl>
  <% end %>
</div>

<div class="section-divider flex-col gap-sm">
  <h2>Begin again</h2>
  <p>This will fully reset the pocket universe. Day 1, with no trace of what was. (Except for your subscription, if you've got one — although to be fair the subscription exists out here and not in there.)</p>
  <p class="mt-md warning-text">This action cannot be undone.</p>

  <%= button_to "Begin Again",
      reset_path,
      method: :post,
      class: "exit mt-md",
      data: { turbo_confirm: "Are you sure? There is no undo!" } %>
</div>
