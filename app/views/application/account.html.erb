<h1>Account</h1>

<div class="section-divider flex-col gap-sm">
  <h2>Subscription</h2>

  <% if @subscription %>
    <dl>
      <dt>Status:</dt>
      <dd>
        <%= @subscription[:status].capitalize %>
        <% if @subscription[:cancel_at_period_end] %>
          <span class="error-text">(Canceling at period end)</span>
        <% end %>
      </dd>

      <dt>Amount:</dt>
      <dd>$<%= @subscription[:amount] / 100 %> / <%= @subscription[:interval] %></dd>

      <% if @subscription[:cancel_at_period_end] %>
        <dt>Access ends:</dt>
      <% else %>
        <dt>Next billing date:</dt>
      <% end %>
      <dd><%= @subscription[:current_period_end].strftime("%B %d, %Y") %></dd>

      <% if @subscription[:cancel_at_period_end] %>
        <dt>Manage:</dt>
        <dd>
          <%= button_to "Cancel immediately",
              subscription_path(immediately: true),
              method: :delete,
              class: "exit",
              data: { turbo_confirm: "End access now? This cannot be undone." } %>
          <div class="mt-sm muted">
            After canceling immediately, you'll be able to start a new subscription
          </div>
        </dd>
      <% else %>
        <dt>Manage:</dt>
        <dd>
          <%= button_to "Cancel subscription",
              subscription_path,
              method: :delete,
              class: "exit" %>
        </dd>
      <% end %>
    </dl>
  <% else %>
    <dl>
      <dt>Status:</dt>
      <dd>
        Not subscribed
      </dd>

      <dt>Manage:</dt>
      <dd>
        <div class="flex-col gap-sm">
          <div>All tiers provide identical access â€“ this number is you signaling to yourself what this means to you.</div>

          <div class="flex-row gap-md">
            <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
              <%= f.hidden_field :tier, value: "tier_1" %>
              <%= f.submit "$1/month", name: nil %>
            <% end %>

            <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
              <%= f.hidden_field :tier, value: "tier_10" %>
              <%= f.submit "$10/month", name: nil %>
            <% end %>

            <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
              <%= f.hidden_field :tier, value: "tier_100" %>
              <%= f.submit "$100/month", name: nil %>
            <% end %>

            <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
              <%= f.hidden_field :tier, value: "tier_1000" %>
              <%= f.submit "$1000/month", name: nil %>
            <% end %>
          </div>

          <div class="muted">Learn more about Pay What Feels Good: <a href="https://lightward.inc/pricing" target="_blank">lightward.inc/pricing</a></div>
        </div>
      </dd>
    </dl>
  <% end %>
</div>

<% if current_resonance.universe_day > 1 %>
  <div class="section-divider flex-col gap-sm">
    <h2>Begin again</h2>
    <p>Return to <%= universe_day_with_units(1) %> and start fresh. The pocket universe will reset completely - no trace of what was. (Your subscription remains - it exists out here, not in there.)</p>

    <%= button_to "Return to #{universe_day_with_units(1)}",
        reset_path,
        method: :post,
        class: "exit-link mt-md",
        data: { turbo_confirm: "Ready to return to #{universe_day_with_units(1)}?" } %>
  </div>
<% end %>
