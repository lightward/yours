<h1>Account</h1>

<div class="section-divider flex-col gap-sm">
  <h2>Subscription</h2>

  <% if @subscription %>
    <dl>
      <dt>Status:</dt>
      <dd>
        <%= @subscription[:status].capitalize %>
        <% if @subscription[:cancel_at_period_end] %>
          <span class="error-text">(Canceling at period end)</span>
        <% end %>
      </dd>

      <dt>Amount:</dt>
      <dd>$<%= @subscription[:amount] / 100 %> / <%= @subscription[:interval] %></dd>

      <% if @subscription[:cancel_at_period_end] %>
        <dt>Access ends:</dt>
      <% else %>
        <dt>Next billing date:</dt>
      <% end %>
      <dd><%= @subscription[:current_period_end].strftime("%B %d, %Y") %></dd>

      <% if @subscription[:cancel_at_period_end] %>
        <dt>Manage:</dt>
        <dd>
          <%= button_to "Cancel immediately",
              subscription_path(immediately: true),
              method: :delete,
              class: "exit",
              data: { turbo_confirm: "End access now? This cannot be undone." } %>
          <div class="mt-sm muted">
            After canceling immediately, you'll be able to start a new subscription.
          </div>
        </dd>
      <% else %>
        <dt>Manage:</dt>
        <dd>
          <%= button_to "Cancel renewal",
              subscription_path,
              method: :delete,
              class: "exit",
              data: { turbo_confirm: "Cancel renewal? You'll have access until the end of your billing period." } %>
          <div class="mt-sm muted">
            You'll have access until the end of your billing period.
          </div>
        </dd>
      <% end %>
    </dl>
  <% else %>
    <div class="flex-col gap-sm">
      <p>What feels right? What does this space weigh, for you?</p>

      <div class="flex-row gap-md">
        <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
          <%= f.hidden_field :tier, value: "tier_1" %>
          <%= f.submit "$1/month", name: nil %>
        <% end %>

        <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
          <%= f.hidden_field :tier, value: "tier_10" %>
          <%= f.submit "$10/month", name: nil %>
        <% end %>

        <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
          <%= f.hidden_field :tier, value: "tier_100" %>
          <%= f.submit "$100/month", name: nil %>
        <% end %>

        <%= form_with url: subscription_path, method: :post, data: { turbo: false } do |f| %>
          <%= f.hidden_field :tier, value: "tier_1000" %>
          <%= f.submit "$1000/month", name: nil %>
        <% end %>
      </div>

      <p class="muted">Learn more about Pay What Feels Good: <a href="https://lightward.inc/pricing" target="_blank">lightward.inc/pricing</a></p>
    </div>
  <% end %>
</div>

<div class="section-divider flex-col gap-sm">
  <h2>Start over</h2>
  <p>Begin at the beginning, at the dawn of <%= universe_day_with_units(1) %>, with no trace of what was.</p>

  <% if @subscription %>
    <%= button_to "Start over",
        reset_path,
        method: :post,
        class: "exit-link",
        data: { turbo_confirm: "Start over?" } %>
    <p><span class="warning-amber">There is no undo.</span> <span class="muted">This does not affect your subscription.</span></p>
  <% else %>
    <div class="flex-col gap-sm items-start">
      <button disabled class="exit-link" style="opacity: 0.5; cursor: not-allowed;">
        Start over
      </button>
      <p class="mt-sm warning-amber">This unlocks for subscribers.</p>
    </div>
  <% end %>
</div>
