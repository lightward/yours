<h1>Account</h1>

<div style="margin: 2rem 0;">
  <h2>Subscription</h2>

  <% if @subscription %>
    <dl>
      <dt><strong>Status:</strong></dt>
      <dd>
        <%= @subscription[:status].capitalize %>
        <% if @subscription[:cancel_at_period_end] %>
          <span style="color: var(--error);">(Canceling at period end)</span>
        <% end %>
      </dd>

      <dt><strong>Amount:</strong></dt>
      <dd>$<%= @subscription[:amount] / 100 %> / <%= @subscription[:interval] %></dd>

      <% if @subscription[:cancel_at_period_end] %>
        <dt><strong>Access ends:</strong></dt>
      <% else %>
        <dt><strong>Next billing date:</strong></dt>
      <% end %>
      <dd><%= @subscription[:current_period_end].strftime("%B %d, %Y") %></dd>

      <% if @subscription[:cancel_at_period_end] %>
        <dt><strong>Manage:</strong></dt>
        <dd>
          <%= button_to "Cancel immediately",
              subscription_path(immediately: true),
              method: :delete,
              class: "exit",
              data: { turbo_confirm: "End access now? This cannot be undone." } %>
          <div style="margin-top: 0.5rem; opacity: 0.7;">
            After canceling immediately, you'll be able to start a new subscription
          </div>
        </dd>
      <% else %>
        <dt><strong>Manage:</strong></dt>
        <dd>
          <%= button_to "Cancel Subscription",
              subscription_path,
              method: :delete,
              class: "exit" %>
        </dd>
      <% end %>
    </dl>
  <% else %>
    <dl>
      <dt><strong>Status:</strong></dt>
      <dd>
        Not subscribed
      </dd>
    </dl>
  <% end %>
</div>

<div style="margin: 3rem 0; padding-top: 2rem; border-top: 1px solid var(--border);">
  <h2>Begin again</h2>
  <p>Want to clear in-universe memory completely? (This will advance the day counter by 1. This will not affect your subscription.)</p>
  <p style="margin-top: 1rem; color: var(--warning);">This action cannot be undone.</p>

  <%= button_to "Begin Again",
      reset_path,
      method: :post,
      class: "exit",
      style: "margin-top: 1rem;",
      data: { turbo_confirm: "Are you sure? There is no undo!" } %>
</div>
