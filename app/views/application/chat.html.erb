<div data-controller="chat" data-chat-narrative-value="<%= @narrative.to_json %>" data-chat-universe-time-value="<%= current_resonance.universe_time %>" data-chat-saved-textarea-value="<%= h(current_resonance.textarea || "") %>" class="chat-container">
  <div id="chat-log" data-chat-target="log" class="chat-log">
    <!-- Messages will appear here -->
  </div>

  <textarea
    data-chat-target="input"
    data-action="keydown->chat#handleKeydown input->chat#handleInput"
    placeholder="Type your message..."
    rows="1"
    class="chat-textarea"
  ></textarea>

  <div data-chat-target="actions" class="chat-actions">
    <div class="chat-actions-left">
      <button
        data-action="click->chat#send"
      >
        Send
      </button>

      <% next_day = current_resonance.universe_day + 1 %>
      <% if !current_resonance.active_subscription? %>
        <%= link_to "Subscribe for day #{next_day}",
            settings_path,
            class: "header-link" %>
      <% else %>
        <%= button_to "Move to day #{next_day}",
            sleep_path,
            method: :post,
            class: "exit-link eod",
            form: { data: { turbo_confirm: "Ready to move to day #{next_day}?" } } %>
      <% end %>
    </div>

    <%= link_to "Save", save_path, class: "quiet-link", data: { turbo: false } %>
  </div>
</div>
