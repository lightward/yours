<div data-controller="chat" data-chat-narrative-value="<%= @narrative.to_json %>" data-chat-universe-time-value="<%= current_resonance.universe_time %>" data-chat-saved-textarea-value="<%= h(current_resonance.textarea || "") %>" class="chat-container">
  <div id="night-transition-overlay" class="night-transition-overlay"></div>

  <div id="chat-log" data-chat-target="log" class="chat-log">
    <!-- Messages will appear here -->
  </div>

  <textarea
    data-chat-target="input"
    data-action="keydown->chat#handleKeydown input->chat#handleInput"
    placeholder="Type your message..."
    rows="1"
    class="chat-textarea"
  ></textarea>

  <div class="chat-actions">
    <button
      data-action="click->chat#send"
    >
      Send
    </button>

    <%= button_to "Move to day #{current_resonance.universe_day + 1}",
        integrate_path,
        method: :post,
        class: "exit-link",
        data: {
          turbo: false,
          action: "chat#startNightTransition"
        } %>
  </div>
</div>
